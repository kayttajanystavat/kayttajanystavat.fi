<?php
    // twitter-skripti, hakee etusivun laatikkoon @kayttajanystava -tilin kolme uusinta tweettiä

    $username = "kayttajanystava";
    $feed = '/home/kay/www-data/twitterxml/twitter.xml';
    $tweets = file_get_contents($feed);
		$tweets = str_replace("&", "&", $tweets);	
		$tweets = str_replace("<", "<", $tweets);
		$tweets = str_replace(">", ">", $tweets);
		$tweet = explode("<item>", $tweets);
    $tcount = count($tweet) - 1;

for ($i = 1; $i <= $tcount; $i++) {
    $endtweet = explode("</item>", $tweet[$i]);
    // tämä on GMT-aika
    $pubDate = explode("<pubDate>", $endtweet[0]);
    $pvm = explode("</pubDate>", $pubDate[1]);
    $pvm = $pvm[0];

    $pvm_osat = explode(" ", $pvm);
    $vkonpaiva = $pvm_osat[0];
    // näistä osista pitäisi askarrella joku oikea aikaleima ja plussata GMT+2-tunnit siihen
    // tai jättää koko kellonaika pois...
    $vkonpaiva = mb_substr($vkonpaiva, 0, 3);
    $paivat_en = array("Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun");
    $paivat_fi = array("Ma", "Ti", "Ke", "To", "Pe", "La", "Su");
    $vkonpaiva = str_replace($paivat_en, $paivat_fi, $vkonpaiva);
    $pv = intval($pvm_osat[1]);
    $kk = $pvm_osat[2];
    $kuukaudet_en = array("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec");
    $kuukaudet_fi = array("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12");
    $kk = str_replace($kuukaudet_en, $kuukaudet_fi, $kk);
    $vuosi = $pvm_osat[3];
    $kello = $pvm_osat[4];
    $kello = explode(":", $kello);
    $tunnit = $kello[0];
    $minuutit = $kello[1];
    //$paivays = $vkonpaiva . " " . $pv . "." . $kk . "." . $vuosi . " " . " klo " . $tunnit . "." . $minuutit; 
    $paivays = $vkonpaiva . " " . $pv . "." . $kk . "." . $vuosi; 

    $title = explode("<title>", $endtweet[0]);
    $content = explode("</title>", $title[1]);
		$content[0] = str_replace("&#8211;", "&mdash;", $content[0]);
		$content[0] = preg_replace("/(http:\/\/|(www\.))(([^\s<]{4,68})[^\s<]*)/", '<a href="http://$2$3">$1$2$4</a>', $content[0]);
		$content[0] = str_replace("$username: ", "", $content[0]);
		$content[0] = preg_replace("/@(\w+)/", "<a href=\"http://www.twitter.com/\\1\">@\\1</a>", $content[0]);
		// $content[0] = preg_replace("/#(\w+)/", "<a href=\"http://search.twitter.com/search?q=\\1\" target=\"_blank\">#\\1</a>", $content[0]);
    $content[0] .= "<div class=\"aikaleima\">$paivays</div>";
    $mytweets[] = $content[0];
}

while (list(, $v) = each($mytweets)) {
	$tweetout .= "<li>$v</li>\n";
}
?>

<p>
Käyttäjän ystävät ry on käytettävyysopiskelijoiden ja muiden alasta kiinnostuneiden poikkitieteellinen yhdistys. Yhdistyksen tarkoituksena on edistää
<!--<a class="tooltip" href="#">käytettävyydestä<span class="classic">TODO: Tähän määritelmä :-)</span></a>--> käytettävyydestä ja käyttöliittymistä kiinnostuneiden ihmisten verkostoitumista, tiedottaa alan opetuksesta, tapahtumista ja uramahdollisuuksista sekä lisätä yleisesti ihmisten tietoisuutta käytettävyydestä ja siihen liittyvistä asioista.</p>
<!-- <div id="uutiset"><a href="https://twitter.com/kayttajanystava"><img src="/images/kay-twitter.png" style="border:0px" alt="Twitter" /></a><ul><?=$tweetout; ?></ul></div> -->

<div style="float: right;"><a class="twitter-timeline" width="250" height="400" href="https://twitter.com/kayttajanystava" data-widget-id="421013504552730624">Tweets by @kayttajanystava</a></div>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>



<p>
Käyttäjän ystävät ry järjestää jäsenilleen monimuotoista toimintaa ja mielekkäitä tapahtumia, erityisesti vierailuja mielenkiintoisiin yrityksiin. Yhdistyksen toimintaa keskittyy pääkaupunkiseudulle ja on suurimmaksi osaksi opiskelija&shy;lähtöistä -- <a href="/liity">mukaan voi liittyä</a> silti kuka tahansa aiheesta kiinnostunut!
</p>
